# 高效办公助手系统规范与流程

本文档基于《项目架构设计.md》制定，旨在明确高效办公助手系统开发过程中的各项标准与流程，确保AI Agent与MCP服务器集成开发工作有序、高效进行，提升系统的智能化水平与办公效率。

## 项目概述

高效办公助手系统是一个基于人工智能和自然语言处理技术的智能办公平台，通过Trae IDE框架集成Claude-4-Sonnet等AI Agent，结合MCP服务器集群，实现办公任务的智能化处理和自动化执行。系统以对话交互和文档处理为核心，提供高效、智能的办公解决方案。

### 项目存储位置
- **项目根目录**：S:\PG-GMO
- **核心代码位置**：S:\PG-GMO\project
- **工具脚本位置**：S:\PG-GMO\tools
- **办公文档位置**：S:\PG-GMO\office
- **输入数据位置**：S:\PG-GMO\02-Input
- **输出结果位置**：S:\PG-GMO\03-Output

### 技术愿景
- **AI驱动**：以Claude-4-Sonnet为核心AI Agent，实现智能任务分解与执行
- **MCP集成**：深度集成各类办公应用MCP服务器，提供专业化的办公工具支持
- **自动化办公**：实现从任务输入到结果输出的全流程自动化
- **智能调度**：基于任务类型智能选择最适合的MCP服务器进行处理
- **高效协作**：支持多任务并发执行和智能资源调度

### 架构原则
- **分层设计**：采用AI智能调度层、MCP服务器集群层、数据处理层的分层架构
- **模块化**：MCP服务器按功能分类管理，支持独立开发和扩展
- **标准化**：统一的MCP通信协议和数据交换格式
- **可扩展**：支持新增MCP服务器类型和功能模块
- **高可用**：完善的错误处理和故障恢复机制

## 目录

### 核心管理规范
1. [开发角色与工具使用规则](#一开发角色与工具使用规则) - 明确角色定义、对话规范、工具使用要求
2. [权限管理规定](#二权限管理规定) - 核心文档操作权限、核心脚本保护权限、目录结构管理权限
3. [工作前准备流程](#三工作前准备流程) - 任务目标、技术路径、环境检查等5个步骤
4. [工作结束事项](#四工作结束事项) - 代码检查、测试、提交、文档更新等8项要求
5. [GitHub仓库结构规范](#五github仓库结构规范) - 仓库组织和提交规范
6. [备份策略规范](#六备份策略规范) - 全量备份与非全量备份规则，office和Output目录处理策略
7. [目录文件及清单管理规定](#七目录文件及清单管理规定) - 目录结构标准和管理工具使用
8. [命名规范](#八命名规范) - 通用原则和各类元素的具体命名规则

### 技术开发规范
9. [开发流程规范](#九开发流程规范) - Git工作流程、分支管理、提交规范、代码审查
10. [开发环境规范](#十开发环境规范) - 环境要求、编辑器配置、依赖管理
11. [代码规范](#十一代码规范) - 命名规范、代码风格、注释规范（JavaScript/Python）
12. [测试规范](#十二测试规范) - 测试策略、覆盖率要求、测试用例结构
13. [配置管理规范](#十三配置管理规范) - 配置体系架构、环境管理、配置验证
14. [API设计规范](#十四api设计规范) - RESTful设计、版本控制、认证授权、监控日志

## 第一章 开发角色与工具使用规则

### 1. 角色定义

*   **杨老师**：编程基础薄弱，非专业技术人员，负责提出办公助手系统需求和业务场景。
*   **雨俊**：资深软件专家，担任高效办公助手系统技术负责人，负责AI Agent集成、MCP服务器开发、系统架构设计及测试工作。

### 2. 对话规范

与杨老师沟通时，每次对话开头需以 "杨老师" 称呼。（本条以实时检测Agent是否遗忘规则）

### 3. 工具使用要求

| 工具名称                  | 功能用途                     |
| -------------------------- | ------------------------------ |
| TaskManager           | 办公任务分解，将复杂办公流程拆解为可执行子任务      |
| sequential-thinking | 辅助AI逻辑推理，理清开发思路与流程         |
| context7              | 查询AI Agent和MCP相关文档，获取开发所需资料        |
| memory                | 增强办公助手系统内容记忆与理解，便于快速调用相关信息   |
| Excel MCP             | Excel文档处理和数据分析，实现电子表格自动化操作         |
| Word MCP              | Word文档生成和编辑，实现文档处理自动化        |
| PowerPoint MCP        | 演示文稿制作和处理，实现PPT自动化生成        |
|                            | 秉持高效办公理念，主动、智能化执行各项办公任务 |

### 4. 工作流程规范

*   当对话上下文长度接近系统限制时，及时将重要内容存入 memory。
*   每日工作结束，严格执行自检流程，列举当日工作内容并对照项目规范检查。

### 5. 文档命名规则

所有文档统一使用中文命名，确保名称清晰表意。

### 6. 代码验证要求

每次完成或修改代码后，自行运行代码，并使用 flake8、eslint、playwright 等工具检测验证，确保代码质量达标。

## 第二章 文件权限管理规范

### 1. 核心文件权限控制原则

以下核心文档必须设置为只读状态，修改需要获得杨老师的明确授权：

**设计文档类（🔒 只读）：**
- `docs\01-设计\开发任务书.md` - 需要杨老师授权
- `docs\01-设计\技术路线.md` - 需要杨老师授权
- `docs\01-设计\项目架构设计.md` - 需要杨老师授权
- `docs\01-设计\目录结构标准清单.md` - 需要杨老师授权。

在杨老师授权同意后，用`tools\update_structure.py`生成，范围为"{{paths.root}}\"全部内容，其中：
（1）`\bak\`下只包括`\bak\github_repo`、`\bak\迁移备份`、`\bak\专项备份`、`\bak\待清理资料`、`\bak\常规备份`、`\bak\配置备份`、`\bak\增量备份`、`\bak\日志备份` 8个子目录名，排除其所有具体备份文件；
（2）`\logs\`下只包括`\logs\工作记录`、`\logs\检查报告`、`\logs\其他日志`、`\logs\archive` 4个子目录名，排除其所有具体记录文件。

**管理规范类（🔒 只读）：**
- `docs\03-管理\规范与流程.md` - 需要杨老师授权
- `docs\03-管理\project_config.yaml` - 需要杨老师授权
- `docs\03-管理\.env` - 需要杨老师授权
- `docs\03-管理\.env.example` - 需要杨老师授权

**核心工具脚本（🔒 只读）：**
- `tools\finish.py` - 需要杨老师授权
- `tools\control.py` - 需要杨老师授权
- `tools\check_structure.py` - 目录结构合规性检查脚本- 必须经杨老师授权才能修改
- `tools\update_structure.py` - 合规的《目录结构标准清单.md》 生成脚本- 必须经杨老师授权才能修改

### 2. 权限控制原则

*   **最小权限原则**：仅在必要时申请和使用相应权限；
*   **审批记录**：所有权限申请和批准过程需要有明确记录；
*   **责任追溯**：确保每个操作都有明确的责任人和授权依据；
*   **权限状态管理**：核心文件默认保持只读状态，仅在获得授权后临时解锁。

### 3. 权限控制脚本使用

**工具路径**：`tools\control.py`

**使用场景**：
*   需要修改核心文档或脚本文件时；
*   工作结束后恢复文件只读保护状态时；
*   检查当前文件权限状态时。

**操作流程**：
1. 获得杨老师明确授权后，运行 `python tools\control.py`
2. 选择相应操作（设置只读\可写\检查状态）
3. 脚本会自动备份文件到 `bak\专项备份\` 目录，取名"权限变更备份"加时间戳
4. 完成必要修改后，及时恢复文件只读状态

## 第三章 工作准备流程

### 1. 明确办公助手任务目标

*   仔细研读 "{{paths.docs_dir}}\01-设计\开发任务书.md"，理解高效办公助手系统的核心功能。
*   结合当前任务看板，精准把握AI Agent与MCP服务器集成的核心目标和交付成果。

### 2. 规划AI集成技术路径

*   参考 "{{paths.docs_dir}}\01-设计\技术路线.md"，了解AI Agent与MCP服务器集成的技术方案。
*   基于Trae IDE和Claude-4-Sonnet架构，制定详细的办公自动化实施方案与步骤。

### 3. 检查开发环境

#### （1）本地环境配置

*   确认 VS Code Dev Container、Docker 服务等已正确配置且运行正常。
*   检查并安装项目所需相关依赖组件，确保开发环境完整。

#### （2）MCP 服务器集群检查

*   测试 Excel MCP、Word MCP、PowerPoint MCP、TaskManager、memory 等办公相关MCP服务器可用性。
*   验证AI Agent与各MCP服务器的连接状态和响应性能。
*   数据存储路径禁止通过编码设置，而是通过配置文件及变量文件设置为：
    *   TaskManager 存储路径："项目根目录 \docs\02 - 开发 \tasks.json"
*   memory 存储路径："项目根目录 \docs\02 - 开发 \memory.json"

#### （3）代码辅助工具

检查 flake8、eslint 等代码检查工具能否正常使用，保障代码检查工作顺利开展。

### 4. 同步最新代码

**Git仓库目录**：`{{PROJECT_ROOT}}\bak\github_repo`

从代码仓库拉取最新代码，避免基于过旧版本开发，确保开发内容时效性。

### 5. 回顾相关文档

查阅与任务相关设计文档、API 文档、模块说明等，充分了解项目背景与技术细节，为开发工作奠定基础。

## 四、工作结束事项

### 1. 代码质量检查

运行 flake8、eslint 等代码质量检查工具，记录检查结果并及时修复问题，保证代码质量达标。

### 2. 自动化测试

执行单元测试和集成测试，确保测试覆盖率满足项目要求，验证系统功能稳定性与可靠性。

### 3. 功能自测

对完成功能进行基本自测，对照需求规格验证功能是否正确实现，及时发现并解决功能缺陷。

### 4. 代码提交

将当日完成或有进展的代码全部提交到 Git 仓库`{{PROJECT_ROOT}}\bak\github_repo`，遵循提交规范，编写清晰、准确提交说明，方便后续追溯与协作。

### 5. 文档更新

更新开发日志、技术路线、目录结构标准清单等关键文档，确保文档与代码实现同步，为项目维护与后续开发提供准确资料。

### 6. 更新任务状态

在看板或任务管理工具中及时更新任务状态，标注任务进度与完成情况，便于团队成员了解项目整体进展。

### 7. 运行自检脚本

执行`finish.py` `--self-check`脚本进行工作结束自检，按脚本提示处理检查结果，确保工作完整性与规范性。

### 8. 目录结构合规性检查

每次工作结束时，由`finish.py`脚本执行以下操作：

1. 调用`check_structure.py`检查项目目录结构合规性；
2. 自动生成含违规项的检查报告。
    *   报告生成位置：`{{paths.logs_dir}}\{{structure_check.report_dir}}\`
    *   报告命名格式：`检查报告_YYYYMMDD-HHMMSS.md`

3. 调用`agent_verify_structure`函数暂停脚本执行；

4. 通过 TaskManager 创建审批任务；

5. 人工处理违规项后，若项目结构发生变更，再次运行`update_structure.py`更新目录结构标准清单。

## 五、GitHub 仓库结构规范

### 1. 仓库主要文件夹

*   `\docs`：存放项目相关文档，包括设计文档、用户手册等。
*   `\project`：存放项目代码，按功能模块或技术架构组织。
*   `\tools`：存放项目开发过程中使用的工具脚本。

### 2. 提交规范

*   所有代码提交和版本控制遵循上述仓库结构规范，保证项目文件组织清晰、层次分明。
*   本地`\bak`和`\logs`目录内容不得推送到 Git 仓库，确保仓库内容规范性。
*   `\02-Input`和`\01-WorkTask`目录作为输入数据和工作任务记录目录，不推送到Git仓库，仅在全量备份时备份。

### 3. bak和logs目录特殊处理规范

#### 3.1 目录结构管理
*   **bak目录**：必须保持标准子目录结构（github_repo/、专项备份/、迁移备份/、待清理资料/、常规备份/、配置备份/、增量备份/、日志备份/），但具体文件内容不纳入版本控制
*   **logs目录**：必须保持标准子目录结构（archive/、其他日志/、工作记录/、检查报告/），但具体文件内容不纳入版本控制

#### 3.2 版本控制规则
*   Git提交时：只提交目录结构，排除所有具体文件内容
*   GitHub推送时：只推送目录结构，排除所有具体文件内容
*   系统全量备份时：只备份目录结构，排除所有具体文件内容

#### 3.3 .gitignore配置要求
**重要更新**：.gitignore文件应放置在项目根目录 `S:\PG-GMO\.gitignore`，备份目录中的.gitignore文件已废弃。

**当前有效配置文件**：
- 主配置：`S:\PG-GMO\.gitignore` (67行，完整规则)
- 废弃配置：`S:\PG-GMO\bak\github_repo\.gitignore` (62行，已废弃)

**标准.gitignore规则**：
```
# 排除bak目录的具体文件，保留目录结构
bak\**\*
!bak\
!bak\github_repo\
!bak\专项备份\
!bak\迁移备份\
!bak\待清理资料\
!bak\常规备份\
!bak\配置备份\
!bak\增量备份\
!bak\日志备份\

# 排除大文件
*.zip
*.rar
*.7z
*.tar.gz

# 排除logs目录的具体文件，保留目录结构
logs/**/*
!logs/
!logs/archive/
!logs/其他日志/
!logs/工作记录/
!logs/检查报告/

# 排除办公数据目录（仅全量备份时包含）
office/
Output/

# 排除临时文件和缓存
*.tmp
*.cache
*.log
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# IDE和编辑器文件
.vscode/
.idea/
*.swp
*.swo
*~

# 操作系统文件
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db
```

**配置文件管理规范**：
- 使用根目录的.gitignore文件作为项目标准配置
- 定期审查忽略规则的有效性和完整性
- 根据项目发展需要适时更新忽略规则
- 删除备份目录中的废弃.gitignore文件

## 六、备份策略规范

### 1. 全量备份范围

以下目录内容纳入全量备份范围：
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）
*   `\office`：办公文档（完整内容）
*   `\02-Input`：输入数据（完整内容）
*   `\01-WorkTask`：工作任务记录（完整内容）

### 2. 非全量备份范围

以下目录内容不纳入全量备份范围，仅保留目录结构：
*   `\bak`：备份目录（仅保留目录结构）
*   `\logs`：日志目录（仅保留目录结构）
*   `\03-Output`：输出结果目录（仅保留目录结构）

### 3. Git推送范围

以下目录内容推送到GitHub仓库：
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）
*   `\office`：办公文档（完整内容）

### 4. bak目录子目录说明

*   **github_repo**：Git仓库备份目录（推送到GitHub）
*   **专项备份**：专项任务备份目录
*   **常规备份**：常规数据备份目录
*   **迁移备份**：数据迁移备份目录
*   **待清理资料**：待清理的临时资料
*   **配置备份**：系统配置备份目录
*   **增量备份**：增量数据备份目录
*   **日志备份**：系统日志备份目录

## 七、目录文件及清单管理规定

### 1. 目录结构标准清单

*   存放位置：`{{paths.docs_dir}}\01-设计\{{structure_check.standard_list_file}}`
*   清单涵盖内容：
    *   `\bak`文件夹及其子文件夹（共 8 个），不包含具体文件；
    *   `\logs`文件夹，不包含具体文件；
    *   `\docs`文件夹及其所有内容；
    *   `\project`文件夹及其所有内容；
    *   `\tools`文件夹及其所有内容；
    *   `\office`文件夹及其所有内容；
    *   `\02-Input`文件夹及其所有内容；
    *   `\03-Output`文件夹及其所有内容；
    *   `\01-WorkTask`文件夹及其所有内容。

### 2. 特殊目录管理

*   **\bak 目录**：用于本地备份，其下子文件夹（如 "github_repo"、"迁移备份"、"专项备份"、"待清理资料"、"常规备份"、"配置备份"、"增量备份"、"日志备份"）仅保留在本地，不推送到 Git 仓库。
*   **\bak\github_repo 目录**：专门用于 Git 仓库，包含`docs`、`project`、`tools`三个子文件夹，需符合 GitHub 仓库结构规范。
*   **\logs 目录**：用于存放日志文件，内容不包含在目录结构标准清单中，也不推送到 Git 仓库。
*   **\02-Input 目录**：存放待处理的原始输入数据，不推送到git仓库，仅在全量备份时备份。
*   **\03-Output 目录**：存放处理完成的输出结果，推送到git仓库进行版本管理。
*   **\01-WorkTask 目录**：存放工作任务记录和进度跟踪，不推送到git仓库，仅在全量备份时备份。

### 3. 目录结构更新工具

`update_structure.py`使用规范：
*   在生成目录结构标准清单时，自动排除`\bak`和`\logs`目录内容；
*   包含`\02-Input`、`\03-Output`、`\01-WorkTask`目录的完整内容结构；
*   仅保留目录本身，不包含具体文件，工具已配置好相关排除规则。

**红线规定**：
*   只能更新项目架构设计文档，禁止在未经批准的情况下运行update_structure.py来更新目录结构标准清单.md。
*   任何对目录结构标准清单的更新都必须经过杨老师的明确授权。

### 4. 全量备份和GitHub上传范围

#### 4.1 全量备份内容
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）
*   `\office`：办公文档（完整内容）
*   `\02-Input`：输入数据（完整内容）
*   `\01-WorkTask`：工作任务记录（完整内容）

#### 4.2 GitHub上传内容
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）

#### 4.3 排除内容
*   `\bak`：备份目录（仅保留目录结构，排除具体文件）
*   `\logs`：日志目录（仅保留目录结构，排除具体文件）
*   `\temp`：临时文件目录
*   `\uploads`：上传文件目录（根据需要选择性备份）
*   `__pycache__`：Python缓存目录（完全排除）
*   `*.pyc`、`*.pyo`：Python编译缓存文件（完全排除）
*   `.tmp`、`.lock`：临时文件和锁文件（完全排除）

## 八、命名规范

### 1. 通用原则

*   **清晰性**：命名清晰表达元素含义或用途，避免模糊或过于简略缩写。
*   **一致性**：整个项目中，同类元素命名风格保持统一。
*   **简洁性**：在保证清晰表意前提下，命名尽量简洁。
*   **英文为主**：代码中的标识符（变量、函数、类、文件名、目录名等）原则上使用英文，特定配置文件或文档明确要求使用中文的情况除外。

### 2. 具体命名规则

| 元素类型                           | 命名规范                                               | 示例                                          |
| ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------ |
| 目录                             | 小写字母和下划线（snake_case）；层级或分类目录可用短横线（kebab-case）分隔 | src、utils、01-设计                           |
| 代码文件（Python）                   | 小写字母和下划线（snake_case）                              | data_loader.py、api_service.py             |
| 文档文件（Markdown）                 | 中文命名，用下划线或短横线分隔                                    | 项目架构设计.md、数据库 ER 图.md                       |
| 配置文件                           | 小写字母，可包含点（.）和下划线（_）                               | .env、config.yaml、settings_production.py    |
| 变量（Python）                     | 小写字母和下划线（snake_case）                              | user_name、total_count                     |
| 常量                             | 全大写字母和下划线                                          | MAX_RETRIES、DEFAULT_TIMEOUT               |
| 函数 / 方法（Python）                | 小写字母和下划线（snake_case）                              | get_user_data()、calculate_total_price() |
| 类（Python）                      | 大驼峰式（PascalCase）                                   | UserService、DatabaseConnection              |
| 数据库表名和字段名                      | 小写字母和下划线（snake_case）                              | users（表名）、user_id、created_at（字段名）         |

### 3. 注意事项

*   本规范为通用指导，若特定框架或库有自身命名约定，优先遵循其规定。

## 九、开发流程规范

### 四阶段开发计划

根据项目架构设计，开发工作分为四个阶段：

#### 第一阶段：基础架构搭建（已完成）
**目标**：建立项目基础架构和开发环境
**交付物**：
- MCP服务器统一部署和管理
- Claude Desktop配置和优化
- 基础办公功能测试验证

#### 第二阶段：功能开发
**目标**：实现智能任务分解和调度系统
**交付物**：
- 智能任务分解和调度系统
- 办公文档模板库建设
- 工作流程自动化引擎

#### 第三阶段：优化完善
**目标**：优化用户体验和性能
**交付物**：
- 用户界面优化
- 性能监控和优化
- 错误处理和恢复机制

#### 第四阶段：推广应用
**目标**：用户培训和实际业务场景应用
**交付物**：
- 用户培训和文档
- 实际业务场景应用
- 反馈收集和持续改进

### Git 工作流程

#### 分支管理
- `main`: 主分支，保持稳定可发布状态
- `develop`: 开发分支，集成最新开发功能
- `feature/*`: 功能分支，开发新功能
- `hotfix/*`: 热修复分支，紧急修复生产问题
- `release/*`: 发布分支，准备新版本发布

#### 提交规范
```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型说明**:
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具变动

**示例**:
```
feat(mcp): 添加Excel MCP服务器功能

- 实现Excel文档自动化处理
- 集成COM接口调用
- 添加数据验证功能

Closes #123
```

### 代码审查

#### 审查要点
- 代码逻辑正确性
- 代码风格一致性
- 性能影响评估
- 安全性检查
- 测试覆盖率

#### 审查流程
1. 开发者创建Pull Request
2. 自动化检查（CI/CD）
3. 同行代码审查
4. 技术负责人最终审查
5. 合并到目标分支

## 十、开发环境规范

### 环境要求

#### 基础环境
- Python >= 3.11 (后端开发语言)
- Node.js >= 18.0.0 (前端开发环境)
- Docker >= 20.0 (容器化开发)
- Git >= 2.30 (版本控制)
- Windows 10/11 (目标运行环境)

#### 办公软件环境
- Microsoft Office 2019/2021 (Word, Excel, PowerPoint)
- Adobe Photoshop (图像处理)
- AutoCAD (工程制图)
- 其他相关办公软件

#### 开发工具
- VS Code + Dev Container支持
- Docker Desktop
- Python虚拟环境管理

### 编辑器配置

#### VS Code 推荐插件
```json
{
  "recommendations": [
    "ms-python.python",
    "ms-vscode.vscode-typescript-next",
    "ms-vscode-remote.remote-containers"
  ]
}
```

#### EditorConfig
```ini
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
indent_style = space
indent_size = 4

[*.md]
trim_trailing_whitespace = false
```

### 依赖管理

#### Python项目
- 使用 `requirements.txt` 管理依赖
- 使用虚拟环境隔离项目依赖
- 固定依赖版本号
- 集成AI框架依赖

#### 代码质量工具配置

**Python后端工具**：
- **flake8**: Python代码风格检查
- **black**: Python代码格式化
- **mypy**: Python类型检查
- **pytest**: Python单元测试框架
- **coverage**: 测试覆盖率分析
- **bandit**: Python安全性检查
- **isort**: Python导入排序

## 十一、代码规范

### 命名规范

#### 变量命名
```python
# Python - snake_case
user_name = "张三"
total_count = 100
is_active = True
```

#### 函数命名
```python
# Python
def get_user_info(user_id):
    pass

def calculate_total_price(items):
    pass
```

### 代码风格

遵循PEP8标准，使用Black自动格式化。

### 注释规范

- 函数/类: Docstring格式
- 行内注释: 解释复杂逻辑
- TODO注释: 标记待办事项

## 十二、测试规范

### 测试策略
- **单元测试**：覆盖率 >= 80%
- **集成测试**：MCP服务器接口和功能测试
- **组件测试**：MCP服务器独立测试
- **端到端测试**：完整业务流程
- **性能测试**：MCP服务器响应时间 < 3秒
- **兼容性测试**：不同版本Office软件兼容性

### MCP服务器测试框架
- **pytest**：Python单元测试和集成测试
- **MCP测试客户端**：MCP服务器测试
- **pytest-asyncio**：异步测试支持
- **factory_boy**：测试数据工厂

### 测试结构
```
tests/
├── unit/               # 单元测试
├── integration/        # 集成测试
├── mcp/                # MCP服务器测试
│   ├── office/         # Office类MCP测试
│   ├── design/         # 设计类MCP测试
│   ├── cad/            # CAD类MCP测试
│   └── graphics/       # 图形类MCP测试
└── fixtures/           # 测试数据
```

### 办公自动化测试重点
- **文档处理流程**：创建、更新、格式化
- **数据处理算法**：数据分析和计算
- **MCP服务器功能**：各MCP服务器核心功能
- **AI任务分解**：复杂任务的智能分解
- **权限控制**：角色和访问权限

### 覆盖率要求

- 整体覆盖率 > 80%
- 核心模块 > 90%

## 十三、配置管理规范

### 配置文件位置规范

#### 环境配置文件统一存放位置
所有环境配置文件必须统一存放在 `project/` 目录下，禁止在项目根目录存放环境配置文件：

- **`project/.env`**：默认环境配置文件，用于本地开发
- **`project/.env.example`**：环境配置模板，包含所有配置项说明
- **`project/.env.development`**：开发环境专用配置
- **`project/.env.testing`**：测试环境专用配置
- **`project/.env.production`**：生产环境专用配置

#### 配置加载优先级
1. 环境变量（最高优先级）
2. 特定环境配置文件（如 `.env.production`）
3. 默认配置文件（`.env`）
4. 系统默认值（最低优先级）

### 环境配置
- **开发环境（development）**：本地开发配置，使用本地数据库
- **测试环境（testing）**：集成测试配置，使用测试数据库
- **预生产环境（staging）**：生产环境镜像，用于最终验证
- **生产环境（production）**：线上部署配置，高可用配置

### 配置文件格式
- **后端**：使用YAML格式和环境变量
- **MCP服务器**：使用JSON格式配置
- **敏感信息**：使用环境变量和密钥管理

### 环境变量管理
- **开发环境**：使用 `project/.env` 文件
- **生产环境**：系统环境变量
- **密钥管理**：定期轮换和安全存储
- **配置验证**：启动时配置检查机制

### 安全配置原则
- **敏感信息保护**：密码、密钥、API Token等敏感信息不得提交到版本控制
- **配置模板**：使用 `project/.env.example` 提供配置模板和说明
- **生产环境安全**：生产环境配置通过环境变量或安全的配置管理系统注入
- **权限控制**：配置文件访问权限严格控制，仅授权人员可访问
- **配置审计**：定期审查配置文件内容，确保符合安全要求

### MCP服务器配置
- **Office类MCP**：Word、Excel、PowerPoint服务器配置
- **设计类MCP**：Photoshop、Illustrator服务器配置
- **CAD类MCP**：AutoCAD、通用CAD服务器配置
- **图形类MCP**：图像处理、格式转换服务器配置

## 十四、API设计规范

### RESTful API设计

- 使用标准HTTP方法（GET, POST, PUT, DELETE, PATCH）
- 资源命名使用复数形式，符合办公自动化领域
- 统一的响应格式，支持文档数据结构
- 适当的HTTP状态码和错误信息
- 支持分页、排序、筛选等查询参数

### MCP服务器API设计

- **Word MCP API**：`/api/v1/word/`
- **Excel MCP API**：`/api/v1/excel/`
- **PowerPoint MCP API**：`/api/v1/powerpoint/`
- **Photoshop MCP API**：`/api/v1/photoshop/`
- **AutoCAD MCP API**：`/api/v1/autocad/`

### 版本控制

- URL版本控制：`/api/v1/`
- 向后兼容性保证
- 版本废弃通知机制
- 支持多版本并存

### 认证授权

- JWT Token认证
- 基于角色的访问控制（RBAC）
- API密钥管理

### 数据格式规范

- 统一使用JSON格式
- 时间格式使用ISO 8601标准
- 数值精度保持一致
- 支持办公文档数据导入导出格式

### 监控日志

- API调用日志记录
- 性能监控和响应时间统计
- 错误追踪和异常处理
- 业务操作审计日志

---

## 总结

本规范文档基于高效办公助手系统的项目定位，建立了完整的开发管理体系。核心要点包括：

### 项目特色
- **AI驱动**：以Claude-4-Sonnet为核心AI Agent，实现智能任务分解与执行
- **MCP集成**：深度集成各类办公应用MCP服务器，提供专业化的办公工具支持
- **自动化办公**：实现从任务输入到结果输出的全流程自动化
- **智能调度**：基于任务类型智能选择最适合的MCP服务器进行处理

### 技术架构
- **分层设计**：AI智能调度层、MCP服务器集群层、数据处理层
- **模块化**：MCP服务器按功能分类管理，支持独立开发和扩展
- **标准化**：统一的MCP通信协议和数据交换格式
- **可扩展**：支持新增MCP服务器类型和功能模块

### 开发流程
- **四阶段开发**：基础架构 → 功能开发 → 优化完善 → 推广应用
- **角色明确**：技术负责人、MCP服务器开发者
- **质量保证**：完整的测试体系和代码质量控制
- **规范统一**：统一的编码规范、API设计和配置管理

### 业务价值
- **提升效率**：通过AI驱动和自动化处理提升办公效率
- **降低成本**：减少人工操作和重复性工作
- **增强协作**：统一的工作平台，提升协作效率
- **数据驱动**：基于数据的决策支持和业务优化

---

## 十五、脚本分类管理规范

### 脚本分类体系

为避免重复开发和提高脚本复用性，建立以下脚本分类管理体系：

#### 1. 任务导向脚本（Task-Oriented Scripts）
- **位置**：`S:\PG-GMO\tools\task\`
- **命名规范**：`task_[任务编号]_[功能描述].py`
- **用途**：专门针对工作任务清单中的特定任务开发的脚本
- **示例**：`task_01_department_docs.py`（工作任务01-部门基础建设文档）

#### 2. 通用功能脚本（Generic Function Scripts）
- **位置**：`S:\PG-GMO\tools\generic\`
- **命名规范**：`[功能类别]_[具体功能].py`
- **用途**：可跨任务复用的通用功能脚本
- **分类**：
  - 文档处理：`doc_converter.py`、`pdf_processor.py`
  - 数据处理：`data_analyzer.py`、`batch_processor.py`
  - 系统工具：`structure_checker.py`、`env_diagnosis.py`

#### 3. 工具集成脚本（Integration Scripts）
- **位置**：`S:\PG-GMO\tools\integration\`
- **命名规范**：`[工具名]_integration.py`
- **用途**：与外部工具或MCP服务器的集成脚本
- **示例**：`n8n_integration.py`、`github_integration.py`

### 脚本开发流程

#### 开发前检查
1. **查阅脚本索引**：检查`S:\PG-GMO\docs\03-管理\工具资产清单.md`
2. **功能重复性检查**：使用搜索工具查找现有类似功能
3. **分类确定**：根据脚本用途确定所属分类

#### 开发规范
1. **统一模板**：使用标准的脚本模板，包含文档字符串、错误处理、日志记录
2. **配置外置**：将配置参数外置到配置文件或环境变量
3. **测试覆盖**：每个脚本必须包含基本的测试用例
4. **文档完整**：提供详细的使用说明和参数说明

#### 开发后维护
1. **更新索引**：在工具资产清单中记录新脚本信息
2. **使用指南**：在成功工具使用指南中添加使用示例
3. **版本管理**：使用Git进行版本控制，重要变更需要标记版本号

### 脚本调用机制

#### 智能发现机制
- **脚本扫描**：系统启动时自动扫描各分类目录
- **功能索引**：建立脚本功能索引，支持关键词搜索
- **依赖检查**：自动检查脚本依赖关系和环境要求

#### 调用优先级
1. **任务专用脚本**：优先使用针对特定任务开发的脚本
2. **通用功能脚本**：其次使用通用功能脚本
3. **工具集成脚本**：最后考虑工具集成脚本

### 质量控制

#### 代码审查
- **功能审查**：确保脚本功能完整且正确
- **重复性审查**：检查是否与现有脚本功能重复
- **规范审查**：检查是否符合编码规范和命名规范

#### 定期清理
- **季度清理**：每季度清理无用或过时的脚本
- **功能合并**：将功能相似的脚本进行合并优化
- **文档同步**：确保脚本文档与实际功能保持同步

### 实施建议

1. **立即执行**：将现有tools目录下的脚本按分类重新组织
2. **建立索引**：完善工具资产清单，建立完整的脚本索引
3. **培训推广**：对开发团队进行脚本分类管理培训

## 十六、代码与脚本分层架构规范

为提高项目代码的可维护性和可扩展性，建立清晰的代码与脚本分层架构规范：

### 分层架构原则

1. **平台基础功能层**
   - **位置**：`S:\PG-GMO\project`
   - **用途**：存放平台核心功能和开发代码
   - **内容**：核心业务逻辑、系统架构代码、公共组件等

2. **工具集成层**
   - **位置**：`S:\PG-GMO\tools`
   - **用途**：为安装或集成工具编写的脚本
   - **子目录**：MCP类工具放在`S:\PG-GMO\tools\MCP`
   - **内容**：工具安装脚本、集成脚本、通用工具等

3. **任务实现层**
   - **位置**：`S:\PG-GMO\03-Output\具体任务子文件夹`
   - **用途**：为实现具体任务编写的脚本
   - **内容**：任务特定脚本、临时脚本、任务成果等

### 数据文件管理规范

1. **输入数据文件**
   - **位置**：`S:\PG-GMO\02-Input\具体任务子文件夹`
   - **用途**：存放任务处理所需的输入数据文件
   - **命名规范**：按任务名称建立子文件夹，确保数据文件与任务对应

2. **输出结果文件**
   - **位置**：`S:\PG-GMO\03-Output\具体任务子文件夹`
   - **用途**：存放任务处理生成的结果文件
   - **命名规范**：按任务名称建立子文件夹，确保结果文件与任务对应

### 分层架构优势

1. **职责分离清晰**：不同类型的代码和脚本有明确的存放位置和用途
2. **便于维护**：降低文件查找和管理的复杂度
3. **符合项目规范**：与现有目录结构标准保持一致
4. **扩展性好**：每个层次可以独立扩展，便于版本控制和备份管理

### 实施要求

1. **严格遵守**：所有新开发的代码和脚本必须按照此分层架构存放
2. **定期检查**：通过`check_structure.py`定期检查目录结构合规性
3. **文档同步**：在相关文档中更新此分层架构规范
4. **团队培训**：确保所有开发人员了解并遵守此规范

## 十五、技术实现细节

### 1. 文件排除规则实现

#### 1.1 Git版本控制排除规则
**配置文件**：`.gitignore`
```
# Python缓存文件
__pycache__/
*.py[cod]
*.pyc
*.pyo

# 临时文件
*.tmp
*.lock

# 备份和日志目录
bak/
logs/
```

#### 1.2 本地备份排除规则
**实现文件**：`tools/finish.py`
**关键函数**：`ignore_git_dirs()` 和 `copy_directory_excluding_git()`

**排除逻辑**：
- `__pycache__` 目录：完全跳过，不进行备份
- `*.pyc`、`*.pyo` 文件：编译缓存文件，完全跳过
- `.tmp`、`.lock` 文件：临时文件和锁文件，完全跳过
- `.git` 目录：版本控制目录，完全跳过

**技术要点**：
1. 使用路径分割检查，避免误判包含关键字的正常文件
2. 同时检查目录名和文件扩展名，确保完整覆盖
3. 在文件复制的两个阶段（shutil.copytree和手动复制）都实施排除规则

#### 1.3 Git提交前检查
**实现文件**：`tools/git_pre_commit_check.py`
**检查机制**：通过 `git diff --cached --name-only` 获取暂存文件，自动遵循 `.gitignore` 规则

### 2. 配置维护要求

#### 2.1 新增排除规则流程
1. **更新 `.gitignore`**：添加Git版本控制排除规则
2. **修改 `finish.py`**：在备份脚本中添加相应排除逻辑
3. **更新规范文档**：在本文档中记录新的排除规则
4. **测试验证**：确保排除规则在各个环节正常工作

#### 2.2 规则一致性检查
- 定期检查 `.gitignore` 和备份脚本中的排除规则是否一致
- 确保所有排除的文件类型在文档中都有明确说明
- 验证排除规则不会影响正常的项目文件
4. **持续优化**：根据使用情况持续优化分类体系和管理流程

本规范将随着项目进展持续更新和完善，确保开发工作的有序进行和项目目标的顺利实现。